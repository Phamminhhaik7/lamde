<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Làm bài thi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: #333;
            text-align: center;
        }

        .exam-selector {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 500;
        }

        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn {
            display: inline-block;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        #quiz-content {
            display: none;
        }

        .question {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        .options {
            margin-top: 10px;
        }

        .option {
            display: block;
            padding: 8px;
            margin: 5px 0;
            cursor: pointer;
        }

        .option:hover {
            background-color: #f8f9fa;
        }

        .option input {
            margin-right: 10px;
        }

        #submit-quiz {
            margin-top: 20px;
            width: 100%;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }

        .correct {
            background-color: #d4edda;
            color: #155724;
        }

        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }

        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #fff;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Làm bài thi</h1>

        <div class="exam-selector">
            <div class="form-group">
                <label for="subject">Môn học:</label>
                <select id="subject">
                    <option value="">Chọn môn học</option>
                </select>
            </div>
            <div class="form-group">
                <label for="category">Mục:</label>
                <select id="category">
                    <option value="">Chọn mục</option>
                </select>
            </div>
            <div class="form-group">
                <label for="exam">Đề thi:</label>
                <select id="exam">
                    <option value="">Chọn đề thi</option>
                </select>
            </div>
            <button id="start-quiz" class="btn btn-primary">Bắt đầu làm bài</button>
        </div>

        <div id="quiz-content">
            <div class="timer">
                Thời gian còn lại: <span id="time-remaining"></span>
            </div>
            <div id="questions"></div>
            <button id="submit-quiz" class="btn btn-primary">Nộp bài</button>
        </div>
    </div>

    <script>
        // GitHub configuration
        const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/Phamminhhaik7/lamde/refs/heads/master/';
        const GITHUB_CONFIG_URL = `${GITHUB_RAW_URL}/data/config.json`;
        
        let config = null;
        let currentExam = null;
        let timeLeft = 0;
        let timer = null;

        // Load configuration
        async function loadConfig() {
            try {
                const response = await fetch(GITHUB_CONFIG_URL);
                if (response.ok) {
                    config = await response.json();
                    updateSubjects();
                }
            } catch (error) {
                console.error('Error loading config:', error);
                alert('Không thể tải cấu hình. Vui lòng thử lại.');
            }
        }

        // Update subject select
        function updateSubjects() {
            const select = document.getElementById('subject');
            select.innerHTML = '<option value="">Chọn môn học</option>';
            Object.entries(config.subjects).forEach(([key, subject]) => {
                select.innerHTML += `<option value="${key}">${subject.name}</option>`;
            });
        }

        // Update category select based on selected subject
        document.getElementById('subject').addEventListener('change', function() {
            const subject = this.value;
            const select = document.getElementById('category');
            select.innerHTML = '<option value="">Chọn mục</option>';
            
            if (subject && config.subjects[subject]) {
                Object.entries(config.subjects[subject].categories).forEach(([key, category]) => {
                    select.innerHTML += `<option value="${key}">${category.name}</option>`;
                });
            }
        });

        // Update exam select based on selected category
        document.getElementById('category').addEventListener('change', function() {
            const subject = document.getElementById('subject').value;
            const category = this.value;
            const select = document.getElementById('exam');
            select.innerHTML = '<option value="">Chọn đề thi</option>';
            
            if (subject && category && config.subjects[subject].categories[category]) {
                config.subjects[subject].categories[category].exams.forEach(exam => {
                    select.innerHTML += `<option value="${exam.id}">${exam.name}</option>`;
                });
            }
        });

        // Start quiz
        document.getElementById('start-quiz').addEventListener('click', async function() {
            const subject = document.getElementById('subject').value;
            const category = document.getElementById('category').value;
            const examId = document.getElementById('exam').value;

            if (!subject || !category || !examId) {
                alert('Vui lòng chọn đầy đủ thông tin');
                return;
            }

            currentExam = config.subjects[subject].categories[category].exams.find(e => e.id === examId);
            if (!currentExam) return;

            // Set time limit based on subject
            timeLeft = subject === 'math' ? 5400 : 3000; // 90 minutes for math, 50 minutes for others
            startTimer();

            // Show quiz content
            document.querySelector('.exam-selector').style.display = 'none';
            document.getElementById('quiz-content').style.display = 'block';

            // Render questions
            renderQuestions(currentExam.answers);
        });

        // Render questions
        function renderQuestions(answers) {
            const container = document.getElementById('questions');
            container.innerHTML = '';

            answers.forEach((answer, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <div class="question-text">Câu ${index + 1}</div>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q${index}" value="A"> A
                        </label>
                        <label class="option">
                            <input type="radio" name="q${index}" value="B"> B
                        </label>
                        <label class="option">
                            <input type="radio" name="q${index}" value="C"> C
                        </label>
                        <label class="option">
                            <input type="radio" name="q${index}" value="D"> D
                        </label>
                    </div>
                `;
                container.appendChild(questionDiv);
            });
        }

        // Start timer
        function startTimer() {
            updateTimerDisplay();
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    submitQuiz();
                }
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('time-remaining').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Submit quiz
        document.getElementById('submit-quiz').addEventListener('click', submitQuiz);

        function submitQuiz() {
            clearInterval(timer);
            const answers = currentExam.answers;
            let score = 0;
            
            answers.forEach((correctAnswer, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                if (selected && selected.value === correctAnswer) {
                    score++;
                }
            });

            const percentage = (score / answers.length) * 100;
            alert(`Điểm của bạn: ${percentage.toFixed(2)}%\nSố câu đúng: ${score}/${answers.length}`);

            // Reset quiz
            document.querySelector('.exam-selector').style.display = 'block';
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('exam').value = '';
            currentExam = null;
        }

        // Initialize
        loadConfig();
    </script>
</body>
</html> 